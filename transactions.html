<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="css/style.css" rel="stylesheet">
        <script src="https://unpkg.com/lucide@latest"></script>  <!-- Lucide Icons integration -->
        <script src="js/main.js" defer></script>
        <script src="js/storage.js"></script>
        <title>Transactions | Budget Tracker</title>
        <style>
            header {
                margin-bottom: 2rem;
            }
            form {
                border: 1px solid #ccc;
                padding: 1rem;
                border-radius: 6px;
                width: 350px;
            }
            input, select {
                width: 100%;
                padding:0.5rem;
                margin: 0.3rem 0;
            }
            #transactionForm button {
                margin-top: 0.5rem;
                padding: 0.5rem 1rem;
                cursor:pointer;
            }
            table {
                margin-top: 2rem;
                width: 100%;
                border-collapse: collapse;
            }
            th, td {
                border: 1px solid #ddd;
                padding: 0.5rem;
                text-align: left;
            }
            th {
                background: #f0f0f0;
            }
            .actions button {
                margin-right: 0.3rem;
            }
        </style>
    </head>
<body>
    <!-- Sidebar navigation -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-head">
            <button class="menu-button" id="menu-button"><i data-lucide="menu"></i></button>

            <div class="sidebar-title">
                <i data-lucide="piggy-bank"></i>
                <h1>Budget Tracker</h1>            
            </div>
        </div>
        <div class="sidebar-nav">
            <a href="index.html"><i data-lucide="home"></i><span>Home</span></a> 
            <a class="current" href="transactions.html"><i data-lucide="receipt"></i><span>Transactions</span></a> 
            <a href="budgets.html"><i data-lucide="wallet"></i><span>Budgets</span></a> 
            <a href="reports.html"><i data-lucide="chart-line"></i><span>Reports</span></a>
        </div>
    </div>

    <main class="main">
        <div class="content">
            <h2>Add a transaction</h2>
            <!-- Form for the transactions -->
            <form id = "transactionForm">
                <label for = "type">Type:</label>
                <select id="type" required>
                    <option value="">--Select--</option>
            <option value="income">Income</option>
            <option value="expense">Expense</option>
            </select>
            <br><br>

            <label for="category">Category</label>
            <input type="text" id="category" placeholder="ex. Groceries, Fun, Utilities" required/>
            <br><br>

            <label for="description">Description</label>
            <input type="text" id="description" placeholder="Specifics" required/>
            <br><br>

            <label for="date">Transaction Date</label>
            <input type="date" id="date" required/>
            <br><br>

            <label for="amount">Amount of $</label>
            <input type="number" id="amount" step="0.01" required/>
            <br><br>

            <button type="submit">Add Transaction</button>
            </form> 

            <hr>

            <h3>Transaction History: </h3>
            <!--Table -->
            <table border="1" id="transactionTable">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Category</th>
                        <th>Description</th>
                        <th>Date</th>
                        <th>Amount ($)</th>
                    </tr>
                </thead>
                <tbody id="transactionTableBody">
                    <!--Transactions will appear here-->
                </tbody>
            </table>
            <h3>Current Balance: $<span id="balance">0.00</span></h3>
        </div>
        <footer>
            <p>Created by Clark Serecky, Jack Ellis, Tomas Karounas and Tyler Stanton | CSCI 3000 - 2025</p> 
        </footer>
    </main>

    <script>
        // DOM and Event Logic
        const form = document.getElementById("transactionForm")
        const tableBody = document.getElementById("transactionTableBody")
        //Load all transactions 
        document.addEventListener("DOMContentLoaded", loadTransactions)

        form.addEventListener("submit", function(event){
            console.log("Button Pushed")
            event.preventDefault()
            const type = document.getElementById("type").value
            const category = document.getElementById("category").value.trim()
            const description = document.getElementById("description").value.trim()
            const date = document.getElementById("date").value
            const amount = parseFloat(document.getElementById("amount").value)

            if(!category || isNaN(amount) || !date){
                alert("Please fill out all required fields. ")
                return
            }

            const transaction = {
                id: Date.now(),
                type,
                category,
                description,
                date,
                amount
            }

            addTransaction(transaction)
            form.reset()
            getTransactions()
        })
        function loadTransactions() {
            const transactions = getTransactions()
            tableBody.innerHTML = ""

            if (transactions.length === 0 ){
                tableBody.innerHTML = "<tr><td colspan='6'>No transactions yet.</td></tr>"
                return
            }
            transactions.forEach(t => {
                const row = document.createElement("tr")
                row.innerHTML = `
                    <td>${t.type}</td>
                    <td>${t.category}</td>
                    <td>${t.description || "-"}</td>
                    <td>${t.date}</td>
                    <td>$${t.amount.toFixed(2)}</td>
                    <td class="actions">
                    <button onclick="handleEdit(${t.id})">Edit</button>
                    <button onclick="handleDelete(${t.id})">Delete</button>
                    </td>
                    `
                tableBody.appendChild(row)
            });
        }
        function handleDelete(id){
            if(confirm("Delete this transaction?")){
                deleteTransaction(id)
                getTransactions()
            }
        }
        function handleEdit(id){
            const transactions = getTransactions()
            const transaction = transactions.find(t => t.id === id)
            if(!transaction) return

            document.getElementById("type").value = transaction.type
            document.getElementById("category").value = transaction.category;
            document.getElementById("description").value = transaction.description;
            document.getElementById("date").value = transaction.date;
            document.getElementById("amount").value = transaction.amount;

            //Temporarly remove submit handler 
            form.removeEventListener("submit", submitHandler)
            form.onsubmit = function(event){
                event.preventDefault()
                transaction.type = document.getElementById("type").value
                transaction.category = document.getElementById("category").value.trim()
                transaction.description = document.getElementById("description").value.trim()
                transaction.date = document.getElementById("date").value
                transaction.amount = parseFloat(document.getElementById("amount").value)
                editTransaction(id, transaction)
                form.reset()
                getTransactions()
                form.onsubmit = null
            }
        }
    </script>
</body>
</html>
